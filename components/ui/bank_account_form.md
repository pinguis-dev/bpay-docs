## 2.2 銀行口座情報入力セクション

※ 最初に国をプルダウンで選択し、国に応じた入力項目を表示

| 項目名           | 入力形式          | 必須 | 備考                         |
|------------------|-------------------|------|------------------------------|
| 銀行名           | テキスト入力     | はい | 例：三菱UFJ銀行               |
| 支店名           | テキスト入力     | はい | 例：渋谷支店                 |
| 口座種別         | 選択式           | はい | 普通、当座                   |
| 口座番号         | 数字入力         | はい | 7桁の数字                   |
| 口座名義人       | テキスト入力     | はい | カタカナ入力推奨             |

## 入力バリデーション仕様

### 入力バリデーション仕様（国別）

#### 日本（JP）

| 項目名       | バリデーション内容                                                   |
|--------------|----------------------------------------------------------------------|
| 銀行名       | 全角・半角混在可、日本語可、20文字以内                                 |
| 支店名       | 全角・半角混在可、日本語可、20文字以内                                 |
| 口座種別     | `普通` または `当座` に限定（ドロップダウンで選択）                     |
| 口座番号     | 半角数字、7桁固定                                                     |
| 口座名義人   | 全角カタカナ（「アイウエオ」等）、スペース・記号不可、30文字以内         |

#### アメリカ（US）

| 項目名         | バリデーション内容                                                   |
|----------------|----------------------------------------------------------------------|
| 銀行名         | 英字・スペース可、記号不可、40文字以内                                 |
| Routing Number | 半角数字、9桁固定、チェックディジットアルゴリズムに従う（ABA準拠）     |
| Account Number | 半角数字、8～12桁（銀行により可変）                                   |
| 口座名義人     | 英字・スペース可、記号不可、30文字以内                                 |

#### 中国（CN）

| 項目名       | バリデーション内容                                                   |
|--------------|----------------------------------------------------------------------|
| 銀行名       | 漢字、20文字以内                                                       |
| 銀行コード   | 半角数字、最大12桁程度（銀行による）                                   |
| 口座番号     | 半角数字、16～19桁                                                     |
| 口座名義人   | 漢字、20文字以内、身分証と一致必須                                     |

#### 韓国（KR）

| 項目名       | バリデーション内容                                                   |
|--------------|----------------------------------------------------------------------|
| 銀行コード   | 半角数字、3桁程度（韓国の銀行コードに準拠）                              |
| 口座番号     | 半角数字、10桁前後（銀行により可変）                                   |
| 口座名義人   | ハングル、特殊記号不可、20文字以内                                      |


## 国別仕様

銀行口座情報は国によって入力項目が異なるため、国を選択後、それに応じた入力フォームを表示します。

### 日本

| 項目名           | 入力形式    | 備考                     |
|------------------|-------------|--------------------------|
| 銀行名           | テキスト入力 | 例：三菱UFJ銀行           |
| 支店名           | テキスト入力 | 例：渋谷支店             |
| 口座種別         | 選択式       | 普通、当座               |
| 口座番号         | 数字入力     | 7桁の数字               |
| 口座名義人       | テキスト入力 | カタカナ入力推奨         |

### アメリカ

| 項目名           | 入力形式    | 備考                   |
|------------------|-------------|------------------------|
| 銀行名           | テキスト入力 | 例：Bank of America     |
| Routing Number   | 数字入力     | 9桁                   |
| Account Number   | 数字入力     | 通常8～12桁程度         |
| 口座名義人       | テキスト入力 | 英語表記推奨           |

### 中国

| 項目名           | 入力形式    | 備考                             |
|------------------|-------------|----------------------------------|
| 銀行名           | テキスト入力 | 例：中国工商银行                   |
| 銀行コード       | 数字入力     | 支店識別に使用                     |
| 口座番号         | 数字入力     | 通常16～19桁                       |
| 口座名義人       | テキスト入力 | 漢字入力、身分証と一致させる必要あり |

### 韓国

| 項目名           | 入力形式    | 備考                         |
|------------------|-------------|------------------------------|
| 銀行コード       | 数字入力     | 銀行名よりコードが多用される     |
| 口座番号         | 数字入力     | 10桁前後が多い                 |
| 口座名義人       | テキスト入力 | ハングル入力                   |


### 実装メモ（Flutter向け）

- 国別にフォームを切り替えるだけでなく、`FormValidator` クラス等でバリデーションロジックも国別分岐で用意
- 銀行コード・口座番号は `RegExp`（正規表現）と `TextInputFormatter` を併用して制御
- `口座名義人` などの文字種制限は `FilteringTextInputFormatter` を利用

### 実装メモ
- 国の選択は `DropdownButton` を使用
- 選択された国に応じて、表示する入力フィールドを条件分岐で切り替える
- バリデーション処理も国ごとに異なるため、分岐ロジックで制御する

## 自動入力仕様

- ユーザーがキャッシュカードをカメラで撮影またはスキャンした場合、以下の情報をOCRで自動抽出・入力候補として反映する
  - 銀行名
  - 支店名
  - 口座種別
  - 口座番号
  - 口座名義人
- OCR処理には `google_mlkit_text_recognition` パッケージの利用を検討
- ユーザーがすでに銀行口座情報を登録済みである場合、前回の情報を `flutter_secure_storage` から取得し、自動入力候補として表示

## データ保存に関する補足

- 入力された銀行口座情報は、ユーザーの居住国に応じて、該当国の銀行口座テーブルに保存されます。
- 別の国の口座情報に更新する場合は、既存の国のテーブルレコードは削除され、新しい国のテーブルに保存されます。
- データ保存・削除ロジックの詳細については、`specs/data/bank_account_saving.md` を参照してください。

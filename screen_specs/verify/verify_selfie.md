# 画面仕様：セルフィー撮影（verify_selfie_screen.dart）

## 1. 概要

- 本人確認プロセスの第2ステップとして、ユーザーの顔写真（セルフィー）を撮影・確認する画面
- 撮影された画像はローカルでプレビュー後、状態に保存され次の画面へ遷移可能
- セルフィー撮影が完了していない場合、遷移不可

## 2. 機能

- カメラ起動・セルフィー撮影
- プレビュー表示
- 撮り直し・確定
- 次へボタン（確認画面へ）

## 3. UI構成

| 要素名           | 種類             | 説明                            |
|------------------|------------------|---------------------------------|
| 撮影プレビュー枠   | CameraPreview     | 撮影中のリアルタイム映像を表示   |
| 撮影ボタン         | IconButton        | 撮影を実行                     |
| 撮影画像プレビュー | Image             | 撮影後の画像を表示             |
| 撮り直しボタン     | TextButton        | 撮り直し時にカメラ再起動       |
| 次へボタン         | ElevatedButton    | 撮影画像を保存し次画面へ遷移   |

## 4. 撮影要件・制限

- 顔全体が正面から映るように指示表示（例：「帽子・マスクを外してください」）
- 明るさ・ピント・フレーム内位置のチェック（機械的なチェックは将来的に対応）
- カメラの権限が未許可の場合、設定画面への誘導

### セルフィー撮影に関するガイド表示

| チェック項目         | 内容例                                               |
|----------------------|------------------------------------------------------|
| 顔の向き             | 正面を向いてください                                 |
| 明るさ               | 明るい場所で撮影してください（逆光は避けてください） |
| 視界の遮り           | 帽子・マスク・サングラスは外してください             |
| 顔全体のフレーム位置 | 顔全体が枠内に収まるようにしてください               |
| カメラの揺れ         | なるべく静止した状態で撮影してください               |
| 背景                 | 白・無地の背景が推奨されます（推奨）                 |

## 5. 遷移仕様

- 撮影完了 → プレビュー表示 → "次へ" 押下で `verify_confirm_screen` に遷移
- 状態は `verifySelfieProvider` に保存される

## 6. テスト観点

- カメラの起動が正常に行えるか
- 撮影後のプレビューが表示されるか
- 撮り直しが正常に動作するか
- 撮影しないまま次へ押すとエラー表示されるか
- 状態が provider に保存されるか

## 7. 技術仕様メモ

- カメラ利用には `camera` パッケージを使用
- 撮影画像は base64 または一時保存ファイルとして保持
- 一時保存画像は Secure Storage に保存はせず、メモリ上のみで保持
- 状態管理：`verifySelfieProvider` を使用し、撮影画像を一時保持
- カメラ初期化時は非同期処理を考慮し、ローディング表示を挿入


## 8. 使用予定パッケージ（Flutter）

- `image_picker`：ユーザーによるカメラ撮影またはギャラリー選択を提供
- `camera`：ガイド枠付きのリアルタイム撮影を実装する際に使用
- `google_mlkit_face_detection`：顔検出・ガイド表示・顔の向き判定などに使用

## 9. その他の実装補足

- 撮影画像は `verifyFormProvider` 経由で状態管理
- 一時保存先として `flutter_secure_storage` を利用
- 撮影画像は Base64 または一時ファイルで保持し、次画面で参照できるようにする

## 8. 備考

- 撮影画像の形式やサイズ要件（縦横比・最大容量）はサーバ側の要件に合わせて調整
- セルフィー画像と本人確認書類の顔画像との照合処理（フェイスマッチング）は次フェーズ以降で検討
- 利用規約の同意は次画面（`verify_confirm_screen`）で取得

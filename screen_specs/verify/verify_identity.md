# 画面仕様：本人確認情報入力（verify_identity_screen.dart）

## 1. 概要

- 本人確認プロセスの第1ステップとして、ユーザーの基本情報と本人確認書類を入力・アップロードする画面
- 入力内容は次画面（セルフィー撮影）に遷移する前に保存される
- 入力途中でも状態が一時保存され、離脱後の再開に対応可能

## 2. 機能

- ユーザー情報入力機能（氏名・生年月日・住所など）
- 本人確認書類アップロード機能（ファイル形式：画像）
- 次へ進むボタン

## 3. UI構成

| 要素名               | 種類           | 説明                              |
|------------------------|----------------|-----------------------------------|
| 氏名入力欄             | TextField      | 姓・名の2フィールド構成           |
| 生年月日入力欄         | DatePicker     | カレンダーから選択                |
| 住所入力欄             | TextField      | 都道府県＋市区町村＋番地入力       |
| 本人確認書類種別選択   | DropdownButton | 運転免許証／マイナンバーカード等   |
| 書類画像アップロード欄 | ImageUploader  | 書類の表・裏の画像をアップロード   |
| 次へボタン             | ElevatedButton | 入力内容の保存＋次画面へ遷移       |


### 3.3 自動入力補助（OSレベル）

- 氏名・生年月日・住所などの入力欄には Google Autofill（Android）および iOS AutoFill に対応
- 各TextFieldには適切な `autofillHints` を指定（例：`AutofillHints.name`, `AutofillHints.birthday`, `AutofillHints.postalCode` など）
- OSから提供される候補を用いて、ユーザーの入力手間を軽減
- 対応端末においては自動入力バーが表示されることを前提にUIを調整

### 3.4 ステップインジケータの表示

- 画面上部に3ステップ中の「ステップ1」を明示（例：「1/3 本人確認情報入力」）
- インジケータは水平バーや数値表示（1・2・3）で構成
- 後続の `verify_selfie_screen`, `verify_confirm_screen` においても同様のUIを表示し、ユーザーに進行状況を明示
- ステップ構成は共通ウィジェットとして `StepIndicatorWidget` を利用予定


## 3.1 国籍によるフォーム切替

- 画面上部に「国籍選択」のプルダウンを配置（例：日本／米国）
- 選択された国籍に応じて、表示される入力フィールドの構成やラベルを切り替える
- 例：
  - 日本：都道府県、市区町村、番地
  - 米国：State、City、Street address
- バリデーションルールも国籍に応じて切り替え（年齢計算や住所構造）

## 3.2 郵便番号入力による自動補完（日本のみ）

- 郵便番号入力欄を追加（例：TextField）
- 日本国籍が選択されている場合にのみ有効
- 郵便番号が7桁入力された時点で ZipCloud API（https://zipcloud.ibsnet.co.jp）を呼び出す
- 取得できた住所情報（都道府県・市区町村・町域）を該当フィールドに自動反映
- 自動補完後もユーザーによる編集は可能
- 通信エラーや該当なしの場合は補完せず、適切なエラーメッセージを表示
- 米国や他国籍選択時は補完機能を無効化し、全項目を手動入力とする

## 4. 入力バリデーション仕様

- 氏名：空欄不可、全角文字チェック（姓・名両方）
- 生年月日：未来日不可、18歳未満エラー
- 住所：空欄不可
- 書類種別：未選択エラー
- 書類画像：表裏2枚ともにアップロード必須
- 国籍選択：未選択の場合はエラー表示
- 国別仕様に基づく住所・書類情報の必須項目チェック

## 5. 遷移仕様

- 入力完了後、「次へ」押下で verify_selfie_screen へ遷移
- 状態は verifyFormProvider に保存

## 6. テスト観点

- 各入力欄の初期状態が空欄であること
- 空欄で送信 → バリデーションエラーになること
- 書類の画像が1枚のみ → エラーになること
- 各入力欄が変更されるたびに、個別の provider に即時保存されること
- アプリ再起動後も途中入力内容が復元されること（flutter_secure_storage 経由）

## 7. 技術仕様メモ

- 各入力項目は個別の Provider によって管理し、入力時点で即時保存される
- Provider 経由で取得された値は flutter_secure_storage にも逐次同期し、再起動時の復元を補助
- 複数項目を統合的に扱う場合は verifyFormProvider 経由で全体状態を集約
- 状態管理：`verifyFormProvider` によって各項目を保持
- 一時保存：`flutter_secure_storage` にて途中データ保存対応
- 書類画像は base64 または multipart 形式で一時保持
- アップロード後、画像の簡易プレビューを表示
- 国籍に応じたフォーム構造はローカル定義またはAPIから取得（例：`form_specifications/JP.json`）
- Provider構成案：
  - `countryProvider`: 現在選択されている国籍を保持
  - `formSpecProvider`: 選択国に応じたフォーム仕様を保持

## 8. 備考

- 利用可能な本人確認書類の種類は事業者の方針により変更可能（定数またはAPI取得）
- 書類画像のアップロードに失敗した場合のリトライ処理あり
- 利用規約の同意は次の確認画面（verify_confirm_screen）で取得予定
